

------

# ğŸ“˜ LeetCode MySQL æ¨¡ç‰ˆå…¨é›†

------

## 1ï¸âƒ£ åŸºç¡€æŸ¥è¯¢ï¼ˆSELECT + WHERE + DISTINCTï¼‰

```sql
-- æŸ¥è¯¢ç‰¹å®šåˆ—
SELECT col1, col2
FROM table
WHERE condition;

-- å»é‡æŸ¥è¯¢
SELECT DISTINCT col
FROM table;
```

------

## 2ï¸âƒ£ èšåˆç»Ÿè®¡ï¼ˆGROUP BY + HAVINGï¼‰

```sql
/* ============================================================
   èšåˆç»Ÿè®¡ï¼ˆGROUP BY + HAVINGï¼‰å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   èšåˆå‡½æ•°ï¼šCOUNT / SUM / AVG / MAX / MIN
   ä½¿ç”¨åœºæ™¯ï¼šåˆ†ç»„ç»Ÿè®¡ã€ç­›é€‰åˆ†ç»„ã€Top-N åˆ†ç»„
============================================================ */


/* ============================================================
 1. åŸºæœ¬åˆ†ç»„ç»Ÿè®¡
   - æ¯ä¸ªç”¨æˆ·çš„è®¢å•æ•°
============================================================ */
SELECT user_id, COUNT(*) AS order_count
FROM Orders
GROUP BY user_id;


/* ============================================================
 2. åˆ†ç»„ + å¤šä¸ªèšåˆ
   - æ¯ä¸ªç”¨æˆ·çš„è®¢å•æ•°å’Œæ€»é‡‘é¢
============================================================ */
SELECT user_id,
       COUNT(*) AS order_count,
       SUM(amount) AS total_amount,
       AVG(amount) AS avg_amount
FROM Orders
GROUP BY user_id;


/* ============================================================
 3. HAVING è¿‡æ»¤åˆ†ç»„
   - æ‰¾è®¢å•æ•° >= 3 çš„ç”¨æˆ·
============================================================ */
SELECT user_id, COUNT(*) AS order_count
FROM Orders
GROUP BY user_id
HAVING COUNT(*) >= 3;


/* ============================================================
 4. GROUP BY å¤šåˆ—
   - æ¯ä¸ªåŸå¸‚ã€æ¯ä¸ªç”¨æˆ·çš„è®¢å•æ•°
============================================================ */
SELECT city, user_id, COUNT(*) AS order_count
FROM Orders
GROUP BY city, user_id;


/* ============================================================
 5. GROUP BY + ORDER BY
   - æŒ‰åŸå¸‚ç»Ÿè®¡è®¢å•æ•°ï¼Œå¹¶æŒ‰æ•°é‡é™åºæ’åº
============================================================ */
SELECT city, COUNT(*) AS order_count
FROM Orders
GROUP BY city
ORDER BY order_count DESC;


/* ============================================================
 6. è®¡ç®—ç™¾åˆ†æ¯”ï¼ˆçª—å£å‡½æ•°ç‰ˆï¼‰
   - æ¯ä¸ªåŸå¸‚è®¢å•æ•°å æ¯”
============================================================ */
--option1:
SELECT city,
       COUNT(*) AS order_count,
       ROUND(COUNT(*) * 1.0 / (SELECT COUNT(*) FROM Orders), 2) AS pct
FROM Orders
GROUP BY city;

--option2:
SELECT city,
       COUNT(*) AS order_count,
       COUNT(*) * 1.0 / SUM(COUNT(*)) OVER() AS pct
FROM Orders
GROUP BY city;


/* ============================================================
 7. æ¡ä»¶èšåˆ (CASE WHEN)
   - æ¯ä¸ªç”¨æˆ·å®Œæˆè®¢å•æ•°ã€å–æ¶ˆè®¢å•æ•°
============================================================ */
SELECT user_id,
       SUM(CASE WHEN status='completed' THEN 1 ELSE 0 END) AS completed_orders,
       SUM(CASE WHEN status='canceled' THEN 1 ELSE 0 END) AS canceled_orders
FROM Orders
GROUP BY user_id;


/* ============================================================
 8. HAVING + å¤šä¸ªæ¡ä»¶
   - æ‰¾å¹³å‡é‡‘é¢ > 50 ä¸”è®¢å•æ•° > 5 çš„ç”¨æˆ·
============================================================ */
SELECT user_id,
       COUNT(*) AS order_count,
       AVG(amount) AS avg_amount
FROM Orders
GROUP BY user_id
HAVING COUNT(*) > 5 AND AVG(amount) > 50;


/* ============================================================
 9. æ‰¾å‡ºæ¯ä¸ªåˆ†ç»„çš„æœ€å¤§/æœ€å°å€¼
   - æ¯ä¸ªéƒ¨é—¨çš„æœ€é«˜å·¥èµ„
============================================================ */
SELECT department_id, MAX(salary) AS max_salary
FROM Employee
GROUP BY department_id;


/* ============================================================
 10. åˆ†ç»„åç­›é€‰ Top-Nï¼ˆå­æŸ¥è¯¢æˆ–çª—å£å‡½æ•°ï¼‰
   - æ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥
============================================================ */
-- çª—å£å‡½æ•°
SELECT name, department, salary
FROM (
  SELECT name, department, salary,
         RANK() OVER(PARTITION BY department ORDER BY salary DESC) rk
  FROM Employee
) t
WHERE rk = 1;

-- å­æŸ¥è¯¢
SELECT e.*
FROM Employee e
WHERE salary = (
    SELECT MAX(salary)
    FROM Employee
    WHERE department_id = e.department_id
);

-- å­æŸ¥è¯¢
SELECT e1.name,  e1.salary
FROM Employee e1
WHERE NOT EXISTS (
    SELECT 1
    FROM Employee e2
    WHERE e2.department_id = e1.department_id
      AND e2.salary > e1.salary
);

```

------

## 3ï¸âƒ£ æ’åº & Top-Nï¼ˆORDER BY + LIMIT + OFFSETï¼‰

```sql
/* ============================================================
   æ’åº & Top-Nï¼ˆORDER BY + LIMIT + OFFSETï¼‰å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   å…³é”®ç‚¹ï¼š
   1) ORDER BY æŒ‡å®šæ’åºå­—æ®µï¼ˆASCå‡åº / DESCé™åºï¼‰
   2) LIMIT é™åˆ¶è¡Œæ•°
   3) OFFSET è·³è¿‡å‰å‡ è¡Œ
============================================================ */


/* ============================================================
 1. åŸºç¡€æ’åº
   - æŒ‰ salary é™åºæ’åˆ—
============================================================ */
SELECT *
FROM Employee
ORDER BY salary DESC;


/* ============================================================
 2. Top-N æŸ¥è¯¢
   - æ‰¾å·¥èµ„æœ€é«˜çš„å‰ 3 å
============================================================ */
SELECT *
FROM Employee
ORDER BY salary DESC
LIMIT 3;


/* ============================================================
 3. Nth é«˜ï¼ˆOFFSETï¼‰
   - æ‰¾å·¥èµ„ç¬¬äºŒé«˜
============================================================ */
SELECT DISTINCT salary
FROM Employee
ORDER BY salary DESC
LIMIT 1 OFFSET 1;

-- Nth é«˜ï¼ˆé€šç”¨ç‰ˆï¼‰
SELECT DISTINCT salary
FROM Employee
ORDER BY salary DESC
LIMIT 1 OFFSET N-1;


/* ============================================================
 4. æ’åº + LIMIT + OFFSET (åˆ†é¡µæŸ¥è¯¢)
   - æ¯é¡µ 10 æ¡ï¼Œå–ç¬¬ 2 é¡µ
============================================================ */
SELECT *
FROM Orders
ORDER BY order_date DESC
LIMIT 10 OFFSET 10;


/* ============================================================
 5. å»é‡ + æ’åº + LIMIT
   - æ‰¾ç¬¬äºŒé«˜çš„å”¯ä¸€å·¥èµ„
============================================================ */
SELECT DISTINCT salary
FROM Employee
ORDER BY salary DESC
LIMIT 1 OFFSET 1;


/* ============================================================
 6. åˆ†ç»„ Top-1ï¼ˆå­æŸ¥è¯¢æ³•ï¼‰
   - æ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„äºº
============================================================ */
SELECT e.*
FROM Employee e
WHERE salary = (
    SELECT MAX(salary)
    FROM Employee
    WHERE department_id = e.department_id
);


/* ============================================================
 7. åˆ†ç»„ Top-Nï¼ˆçª—å£å‡½æ•°æ³•ï¼ŒMySQL 8+ï¼‰
   - æ¯ä¸ªéƒ¨é—¨å·¥èµ„å‰ 3 å
============================================================ */
SELECT name, department_id, salary
FROM (
  SELECT name, department_id, salary,
         RANK() OVER(PARTITION BY department_id ORDER BY salary DESC) rk
  FROM Employee
) t
WHERE rk <= 3;


/* ============================================================
 8. DENSE_RANK æ¨¡ç‰ˆï¼ˆé¿å…è·³çº§ï¼‰
   - LeetCode 176, 177 å…¸å‹
============================================================ */
SELECT salary,
       DENSE_RANK() OVER(ORDER BY salary DESC) AS rnk
FROM Employee;


/* ============================================================
 9. ç™¾åˆ†æ¯”æ’åï¼ˆPERCENT_RANKï¼‰
   - ç»Ÿè®¡æ¯ä¸ªå‘˜å·¥å·¥èµ„åœ¨å…¨ä½“ä¸­çš„ç™¾åˆ†ä½
============================================================ */
SELECT name, salary,
       PERCENT_RANK() OVER(ORDER BY salary) AS pct_rank
FROM Employee;

```

------

## 4ï¸âƒ£ çª—å£å‡½æ•°ï¼ˆRANK, ROW_NUMBER, LAG, LEADï¼‰

```sql
/* ============================================================
   çª—å£å‡½æ•°ï¼ˆRANK, ROW_NUMBER, LAG, LEADï¼‰å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   ç¤ºä¾‹è¡¨ï¼šEmployee
   +----+---------+-------------+--------+
   | id | name    | department  | salary |
   +----+---------+-------------+--------+
   |  1 | Alice   | HR          | 6000   |
   |  2 | Bob     | HR          | 7000   |
   |  3 | Carol   | HR          | 7000   |
   |  4 | David   | IT          | 8000   |
   |  5 | Eva     | IT          | 9000   |
   |  6 | Frank   | IT          | 7500   |
   +----+---------+-------------+--------+
============================================================ */


/* ============================================================
 1. ROW_NUMBER() â†’ åˆ†ç»„å†…æ’åºï¼Œå”¯ä¸€åºå·
   åº”ç”¨ï¼šæ¯ç»„å–å‰ N æ¡
============================================================ */
SELECT name, department, salary,
       ROW_NUMBER() OVER(PARTITION BY department ORDER BY salary DESC) AS rn
FROM Employee;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+------------+--------+----+
-- | name  | department | salary | rn |
-- +-------+------------+--------+----+
-- | Bob   | HR         | 7000   |  1 |
-- | Carol | HR         | 7000   |  2 |
-- | Alice | HR         | 6000   |  3 |
-- | Eva   | IT         | 9000   |  1 |
-- | David | IT         | 8000   |  2 |
-- | Frank | IT         | 7500   |  3 |
-- +-------+------------+--------+----+


/* ============================================================
 2. RANK() â†’ åˆ†ç»„å†…æ’åï¼ˆç›¸åŒå€¼å¹¶åˆ—ï¼Œåé¢ä¼šè·³å·ï¼‰
   åº”ç”¨ï¼šå·¥èµ„æ’åï¼ˆå…è®¸å¹¶åˆ—ï¼‰
============================================================ */
SELECT name, department, salary,
       RANK() OVER(PARTITION BY department ORDER BY salary DESC) AS rk
FROM Employee;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+------------+--------+----+
-- | name  | department | salary | rk |
-- +-------+------------+--------+----+
-- | Bob   | HR         | 7000   |  1 |
-- | Carol | HR         | 7000   |  1 |
-- | Alice | HR         | 6000   |  3 |
-- | Eva   | IT         | 9000   |  1 |
-- | David | IT         | 8000   |  2 |
-- | Frank | IT         | 7500   |  3 |
-- +-------+------------+--------+----+


/* ============================================================
 3. DENSE_RANK() â†’ åˆ†ç»„å†…æ’åï¼ˆç›¸åŒå€¼å¹¶åˆ—ï¼Œä¸è·³å·ï¼‰
   åº”ç”¨ï¼šæ‰¾ç¬¬ N é«˜å·¥èµ„ï¼ˆä¸ä¼šç©ºç¼ºï¼‰
============================================================ */
SELECT name, department, salary,
       DENSE_RANK() OVER(PARTITION BY department ORDER BY salary DESC) AS drk
FROM Employee;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+------------+--------+-----+
-- | name  | department | salary | drk |
-- +-------+------------+--------+-----+
-- | Bob   | HR         | 7000   |  1  |
-- | Carol | HR         | 7000   |  1  |
-- | Alice | HR         | 6000   |  2  |
-- | Eva   | IT         | 9000   |  1  |
-- | David | IT         | 8000   |  2  |
-- | Frank | IT         | 7500   |  3  |
-- +-------+------------+--------+-----+


/* ============================================================
 4. LAG() â†’ å–å‰ä¸€è¡Œçš„å€¼
   åº”ç”¨ï¼šå¯¹æ¯”å½“å‰å·¥èµ„å’Œä¸Šä¸€ä¸ªå·¥èµ„
============================================================ */
SELECT name, department, salary,
       LAG(salary,1) OVER(PARTITION BY department ORDER BY salary DESC) AS prev_salary
FROM Employee;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+------------+--------+-------------+
-- | name  | department | salary | prev_salary |
-- +-------+------------+--------+-------------+
-- | Bob   | HR         | 7000   | NULL        |
-- | Carol | HR         | 7000   | 7000        |
-- | Alice | HR         | 6000   | 7000        |
-- | Eva   | IT         | 9000   | NULL        |
-- | David | IT         | 8000   | 9000        |
-- | Frank | IT         | 7500   | 8000        |
-- +-------+------------+--------+-------------+


/* ============================================================
 5. LEAD() â†’ å–åä¸€è¡Œçš„å€¼
   åº”ç”¨ï¼šå¯¹æ¯”å½“å‰å·¥èµ„å’Œä¸‹ä¸€ä½å·¥èµ„
============================================================ */
SELECT name, department, salary,
       LEAD(salary,1) OVER(PARTITION BY department ORDER BY salary DESC) AS next_salary
FROM Employee;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+------------+--------+-------------+
-- | name  | department | salary | next_salary |
-- +-------+------------+--------+-------------+
-- | Bob   | HR         | 7000   | 7000        |
-- | Carol | HR         | 7000   | 6000        |
-- | Alice | HR         | 6000   | NULL        |
-- | Eva   | IT         | 9000   | 8000        |
-- | David | IT         | 8000   | 7500        |
-- | Frank | IT         | 7500   | NULL        |
-- +-------+------------+--------+-------------+


/* ============================================================
 6. ç´¯ç§¯å’Œï¼ˆSUM() OVERï¼‰
   åº”ç”¨ï¼šå·¥èµ„ç´¯è®¡å€¼+
   å¦‚æœä½ æƒ³è¦ã€ŒçœŸæ­£çš„é€è¡Œç´¯è®¡å’Œã€ï¼Œå¿…é¡» å†™ ROWSï¼Œä¸èƒ½åªå†™ ORDER BYï¼š
============================================================ */
SELECT name, department, salary,
       SUM(salary) OVER(PARTITION BY department ORDER BY salary DESC) AS running_total
FROM Employee;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+------------+--------+---------------+
-- | name  | department | salary | running_total |
-- +-------+------------+--------+---------------+
-- | Bob   | HR         | 7000   | 7000          |
-- | Carol | HR         | 7000   | 14000         |
-- | Alice | HR         | 6000   | 20000         |
-- | Eva   | IT         | 9000   | 9000          |
-- | David | IT         | 8000   | 17000         |
-- | Frank | IT         | 7500   | 24500         |
-- +-------+------------+--------+---------------+


/* ============================================================
 7. ç§»åŠ¨å¹³å‡ï¼ˆAVG() OVER with ROWSï¼‰
   åº”ç”¨ï¼šå–å½“å‰è¡ŒåŠå‰1è¡Œã€å1è¡Œçš„å¹³å‡å·¥èµ„
============================================================ */
SELECT name, department, salary,
       AVG(salary) OVER(PARTITION BY department ORDER BY salary
                        ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) AS moving_avg
FROM Employee;

-- é¢„æœŸè¾“å‡º (HR éƒ¨é—¨ä¸¾ä¾‹)ï¼š
-- +-------+------------+--------+-------------+
-- | name  | department | salary | moving_avg  |
-- +-------+------------+--------+-------------+
-- | Alice | HR         | 6000   | 6500.0      |
-- | Bob   | HR         | 7000   | 6666.7      |
-- | Carol | HR         | 7000   | 6500.0      |
-- (IT éƒ¨é—¨ç±»ä¼¼è®¡ç®—ç»“æœ)

```

------

## 5ï¸âƒ£ JOINï¼ˆå¤šè¡¨è¿æ¥ï¼‰

```sql
-- å†…è¿æ¥
SELECT a.col, b.col
FROM A a
JOIN B b ON a.id = b.id;

-- å·¦è¿æ¥
SELECT a.col, b.col
FROM A a
LEFT JOIN B b ON a.id = b.id;

-- è‡ªè¿æ¥
SELECT e.name
FROM Employee e
JOIN Employee m ON e.managerId = m.id
WHERE e.salary > m.salary;
```

------

## 6ï¸âƒ£ å­æŸ¥è¯¢ï¼ˆSubquery, EXISTS, NOT EXISTSï¼‰

```sql
/* ============================================================
   å­æŸ¥è¯¢ï¼ˆSubquery, EXISTS, NOT EXISTSï¼‰å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   ç¤ºä¾‹è¡¨ï¼š
   Users
   +----+-------+
   | id | name  |
   +----+-------+
   |  1 | Alice |
   |  2 | Bob   |
   |  3 | Carol |
   |  4 | David |
   +----+-------+

   Orders
   +----+---------+----------+
   | id | user_id | amount   |
   +----+---------+----------+
   |  1 |    1    |   100    |
   |  2 |    1    |   200    |
   |  3 |    2    |   150    |
   |  4 |    3    |   50     |
   +----+---------+----------+
============================================================ */


/* ============================================================
 1. å­æŸ¥è¯¢ in WHERE
   åº”ç”¨ï¼šæ‰¾å‡ºæœ‰ä¸‹è¿‡è®¢å•çš„ç”¨æˆ·
============================================================ */
SELECT name
FROM Users
WHERE id IN (SELECT DISTINCT user_id FROM Orders);

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+
-- | name  |
-- +-------+
-- | Alice |
-- | Bob   |
-- | Carol |
-- +-------+


/* ============================================================
 2. å­æŸ¥è¯¢ with NOT IN
   åº”ç”¨ï¼šæ‰¾å‡ºæ²¡æœ‰ä¸‹è¿‡è®¢å•çš„ç”¨æˆ·
============================================================ */
SELECT name
FROM Users
WHERE id NOT IN (SELECT user_id FROM Orders);

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+
-- | name  |
-- +-------+
-- | David |
-- +-------+


/* ============================================================
 3. å­æŸ¥è¯¢ in SELECT å­å¥
   åº”ç”¨ï¼šæŸ¥è¯¢ç”¨æˆ·åŠå…¶è®¢å•æ•°
============================================================ */
SELECT name,
       (SELECT COUNT(*) FROM Orders o WHERE o.user_id=u.id) AS order_count
FROM Users u;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+--------------+
-- | name  | order_count  |
-- +-------+--------------+
-- | Alice |      2       |
-- | Bob   |      1       |
-- | Carol |      1       |
-- | David |      0       |
-- +-------+--------------+


/* ============================================================
 4. å­æŸ¥è¯¢ in FROM å­å¥ (æ´¾ç”Ÿè¡¨)
   åº”ç”¨ï¼šç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è®¢å•é‡‘é¢ï¼Œå¹¶ç­›é€‰é‡‘é¢>200çš„ç”¨æˆ·
============================================================ */
SELECT name, total_amount
FROM (
    SELECT u.id, u.name, SUM(o.amount) AS total_amount
    FROM Users u
    LEFT JOIN Orders o ON u.id=o.user_id
    GROUP BY u.id, u.name
) t
WHERE total_amount > 200;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+--------------+
-- | name  | total_amount |
-- +-------+--------------+
-- | Alice |    300       |
-- +-------+--------------+


/* ============================================================
 5. EXISTS å­æŸ¥è¯¢
   åº”ç”¨ï¼šæ‰¾å‡ºæœ‰è®¢å•çš„ç”¨æˆ·
============================================================ */
SELECT name
FROM Users u
WHERE EXISTS (
    SELECT 1 FROM Orders o WHERE o.user_id=u.id
);

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+
-- | name  |
-- +-------+
-- | Alice |
-- | Bob   |
-- | Carol |
-- +-------+


/* ============================================================
 6. NOT EXISTS å­æŸ¥è¯¢
   åº”ç”¨ï¼šæ‰¾å‡ºæ²¡æœ‰è®¢å•çš„ç”¨æˆ·
============================================================ */
SELECT name
FROM Users u
WHERE NOT EXISTS (
    SELECT 1 FROM Orders o WHERE o.user_id=u.id
);

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+
-- | name  |
-- +-------+
-- | David |
-- +-------+


/* ============================================================
 7. ç›¸å…³å­æŸ¥è¯¢ï¼ˆCorrelated Subqueryï¼‰
   åº”ç”¨ï¼šæ‰¾å‡ºæ¯”è‡ªå·±å¹³å‡è®¢å•é‡‘é¢é«˜çš„ç”¨æˆ·
============================================================ */
SELECT name, amount
FROM Orders o1
WHERE amount > (
    SELECT AVG(amount)
    FROM Orders o2
    WHERE o2.user_id=o1.user_id
);

-- é¢„æœŸè¾“å‡ºï¼š
-- +----+-------+
-- |name |amount|
-- +----+-------+
-- |Alice| 200  |
-- +----+-------+

```

------

## 7ï¸âƒ£ å»é‡ / é‡å¤å¤„ç†

```sql
/* ============================================================
   å»é‡ / é‡å¤å¤„ç† å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   ç¤ºä¾‹è¡¨ï¼šPerson
   +----+---------+--------------------+
   | id | name    | email              |
   +----+---------+--------------------+
   |  1 | Alice   | alice@leetcode.com |
   |  2 | Bob     | bob@leetcode.com   |
   |  3 | Carol   | alice@leetcode.com |
   |  4 | David   | david@leetcode.com |
   |  5 | Eva     | bob@leetcode.com   |
   +----+---------+--------------------+
============================================================ */


/* ============================================================
 1. DISTINCT å»é‡æŸ¥è¯¢
   åº”ç”¨ï¼šå»é‡åçš„é‚®ç®±åˆ—è¡¨
============================================================ */
SELECT DISTINCT email
FROM Person;

-- é¢„æœŸè¾“å‡ºï¼š
-- +--------------------+
-- | email              |
-- +--------------------+
-- | alice@leetcode.com |
-- | bob@leetcode.com   |
-- | david@leetcode.com |
-- +--------------------+


/* ============================================================
 2. GROUP BY æ‰¾é‡å¤å€¼
   åº”ç”¨ï¼šæ‰¾å‡ºé‡å¤å‡ºç°çš„é‚®ç®±
============================================================ */
SELECT email
FROM Person
GROUP BY email
HAVING COUNT(*) > 1;

-- é¢„æœŸè¾“å‡ºï¼š
-- +--------------------+
-- | email              |
-- +--------------------+
-- | alice@leetcode.com |
-- | bob@leetcode.com   |
-- +--------------------+


/* ============================================================
 3. GROUP BY + COUNTï¼ˆç»Ÿè®¡æ¯ä¸ªå€¼å‡ºç°æ¬¡æ•°ï¼‰
============================================================ */
SELECT email, COUNT(*) AS cnt
FROM Person
GROUP BY email;

-- é¢„æœŸè¾“å‡ºï¼š
-- +--------------------+-----+
-- | email              | cnt |
-- +--------------------+-----+
-- | alice@leetcode.com |  2  |
-- | bob@leetcode.com   |  2  |
-- | david@leetcode.com |  1  |
-- +--------------------+-----+


/* ============================================================
 4. åˆ é™¤é‡å¤æ•°æ®ï¼ˆä¿ç•™æœ€å° idï¼‰
   åº”ç”¨ï¼šLeetCode 196 Delete Duplicate Emails
============================================================ */
DELETE p1
FROM Person p1
JOIN Person p2
ON p1.email = p2.email AND p1.id > p2.id;

-- é¢„æœŸæ‰§è¡Œå Person è¡¨ï¼š
-- +----+---------+--------------------+
-- | id | name    | email              |
-- +----+---------+--------------------+
-- |  1 | Alice   | alice@leetcode.com |
-- |  2 | Bob     | bob@leetcode.com   |
-- |  4 | David   | david@leetcode.com |
-- +----+---------+--------------------+


/* ============================================================
 5. ä¿ç•™æœ€æ–°è®°å½•ï¼ˆæŒ‰ id æˆ–æ—¶é—´æˆ³ï¼‰
============================================================ */
SELECT p.*
FROM Person p
WHERE p.id = (
    SELECT MIN(id) 
    FROM Person
    WHERE email = p.email
);

-- é¢„æœŸè¾“å‡ºï¼ˆæ¯ä¸ªé‚®ç®±ä¿ç•™ id æœ€å°çš„è®°å½•ï¼‰ï¼š
-- +----+---------+--------------------+
-- | id | name    | email              |
-- +----+---------+--------------------+
-- |  1 | Alice   | alice@leetcode.com |
-- |  2 | Bob     | bob@leetcode.com   |
-- |  4 | David   | david@leetcode.com |
-- +----+---------+--------------------+


/* ============================================================
 6. ç”¨çª—å£å‡½æ•°å»é‡ (ROW_NUMBER)
   åº”ç”¨ï¼šä¿ç•™æ¯ä¸ªé‚®ç®±ç¬¬ä¸€æ¡è®°å½•
============================================================ */
WITH cte AS (
  SELECT id, name, email,
         ROW_NUMBER() OVER(PARTITION BY email ORDER BY id) rn
  FROM Person
)
SELECT id, name, email
FROM cte
WHERE rn = 1;

-- é¢„æœŸè¾“å‡ºï¼ˆåŒä¸Šï¼‰ï¼š
-- +----+---------+--------------------+
-- | id | name    | email              |
-- +----+---------+--------------------+
-- |  1 | Alice   | alice@leetcode.com |
-- |  2 | Bob     | bob@leetcode.com   |
-- |  4 | David   | david@leetcode.com |
-- +----+---------+--------------------+


/* ============================================================
 7. ä»…é€‰å–é‡å¤æ•°æ®ï¼ˆä¸å»é‡ï¼‰
   åº”ç”¨ï¼šåˆ—å‡ºæ‰€æœ‰é‡å¤é‚®ç®±çš„è®°å½•
============================================================ */
SELECT *
FROM Person
WHERE email IN (
    SELECT email
    FROM Person
    GROUP BY email
    HAVING COUNT(*) > 1
);

-- é¢„æœŸè¾“å‡ºï¼š
-- +----+---------+--------------------+
-- | id | name    | email              |
-- +----+---------+--------------------+
-- |  1 | Alice   | alice@leetcode.com |
-- |  3 | Carol   | alice@leetcode.com |
-- |  2 | Bob     | bob@leetcode.com   |
-- |  5 | Eva     | bob@leetcode.com   |
-- +----+---------+--------------------+

```

------

## 8ï¸âƒ£ è¿ç»­åŒºé—´ / åºåˆ—é—®é¢˜

```sql
/* ============================================================
   ç¤ºä¾‹æ•°æ®è¡¨ï¼šLogins
   ------------------------------------------------------------
   +---------+------------+
   | user_id | login_date |
   +---------+------------+
   |   1     | 2023-01-01 |
   |   1     | 2023-01-02 |
   |   1     | 2023-01-03 |
   |   1     | 2023-01-05 |
   |   1     | 2023-01-06 |
   |   2     | 2023-01-01 |
   |   2     | 2023-01-04 |
   |   2     | 2023-01-05 |
   |   2     | 2023-01-06 |
   +---------+------------+
============================================================ */


/* ============================================================
 æ–¹æ³•ä¸€ï¼šAnchor Key æ³•
 ------------------------------------------------------------
 æ€è·¯ï¼šåˆ©ç”¨ (æ—¥æœŸ - row_number) åˆ†ç»„ï¼Œå·®å€¼ç›¸åŒè¡¨ç¤ºè¿ç»­
 é€‚ç”¨åœºæ™¯ï¼šè¿ç»­æ—¥æœŸåŒºé—´ / è¿ç»­ ID åŒºé—´ / è¿ç»­ç™»å½•å¤©æ•°
 ä¼˜ç‚¹ï¼šç®€æ´é«˜æ•ˆï¼Œå¯è¯»æ€§å¼º
 ç¼ºç‚¹ï¼šä¾èµ– MySQL 8+ çª—å£å‡½æ•°
============================================================ */
WITH cte AS (
  SELECT user_id,
         login_date,
         ROW_NUMBER() OVER(PARTITION BY user_id ORDER BY login_date) rn
  FROM Logins
)
SELECT user_id,
       MIN(login_date) AS start_date,
       MAX(login_date) AS end_date
FROM cte
GROUP BY user_id, DATE_SUB(login_date, INTERVAL rn DAY);

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+------------+------------+
-- | user_id | start_date | end_date   |
-- +---------+------------+------------+
-- |   1     | 2023-01-01 | 2023-01-03 |
-- |   1     | 2023-01-05 | 2023-01-06 |
-- |   2     | 2023-01-01 | 2023-01-01 |
-- |   2     | 2023-01-04 | 2023-01-06 |
-- +---------+------------+------------+


/* ============================================================
 æ–¹æ³•äºŒï¼šLAG() å·®å€¼æ³•
 ------------------------------------------------------------
 æ€è·¯ï¼šç”¨ LAG() æ¯”è¾ƒå½“å‰è¡Œä¸å‰ä¸€è¡Œæ—¥æœŸå·®ï¼Œå¦‚æœå·®å€¼>1åˆ™æ–­å¼€
 é€‚ç”¨åœºæ™¯ï¼šæ‰¾æ–­ç‚¹ï¼ˆéè¿ç»­ä½ç½®ï¼‰
 ä¼˜ç‚¹ï¼šç›´è§‚æ¸…æ™°
 ç¼ºç‚¹ï¼šåªèƒ½æ‰¾åˆ°æ–­ç‚¹ï¼Œè¿˜éœ€äºŒæ¬¡å¤„ç†åŒºé—´ï¼›ä¾èµ– MySQL 8+
============================================================ */
WITH cte AS (
  SELECT user_id,
         login_date,
         LAG(login_date) OVER(PARTITION BY user_id ORDER BY login_date) pre_date
  FROM Logins
)
SELECT user_id, login_date, pre_date
FROM cte
WHERE DATEDIFF(login_date, pre_date) > 1;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+------------+------------+
-- | user_id | login_date | pre_date   |
-- +---------+------------+------------+
-- |   1     | 2023-01-05 | 2023-01-03 |
-- |   2     | 2023-01-04 | 2023-01-01 |
-- +---------+------------+------------+


/* ============================================================
 æ–¹æ³•ä¸‰ï¼šè¿ç»­ N æ¬¡ç›¸åŒå€¼ï¼ˆLeetCode 180ï¼‰
 ------------------------------------------------------------
 æ€è·¯ï¼šç”¨å¤šæ¬¡ LAG() æ£€æŸ¥å½“å‰è¡Œä¸å‰ N-1 è¡Œæ˜¯å¦ç›¸åŒ
 é€‚ç”¨åœºæ™¯ï¼šè¿ç»­ N æ¬¡ç›¸åŒå€¼ï¼ˆå¦‚è¿ç»­3å¤©ç›¸åŒï¼‰
 ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œé€‚åˆå›ºå®š N
 ç¼ºç‚¹ï¼šN è¶Šå¤§å†™æ³•è¶Šç¹çï¼›ä¾èµ– MySQL 8+
============================================================ */
-- ç¤ºä¾‹æ•°æ®ï¼šLogs(num)
-- +----+-----+
-- | id | num |
-- +----+-----+
-- |  1 | 1   |
-- |  2 | 1   |
-- |  3 | 1   |
-- |  4 | 2   |
-- |  5 | 2   |
-- |  6 | 3   |
-- |  7 | 3   |
-- |  8 | 3   |
-- +----+-----+

SELECT DISTINCT num
FROM (
  SELECT num,
         LAG(num,1) OVER(ORDER BY id) pre1,
         LAG(num,2) OVER(ORDER BY id) pre2
  FROM Logs
) t
WHERE num=pre1 AND num=pre2;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-----+
-- | num |
-- +-----+
-- |  1  |
-- |  3  |
-- +-----+


/* ============================================================
 æ–¹æ³•å››ï¼šGaps and Islands
 ------------------------------------------------------------
 æ€è·¯ï¼šåˆ©ç”¨ (id - row_number) ç»™åºåˆ—åˆ†ç»„ï¼Œåˆ†ç»„å†…å³è¿ç»­åŒºé—´
 é€‚ç”¨åœºæ™¯ï¼šè¿ç»­ ID åºåˆ—åˆ†æ®µ / è®¢å•å·åŒºé—´
 ä¼˜ç‚¹ï¼šç»å…¸é€šç”¨ï¼Œé€‚åˆè¿ç»­æ•°åˆ—
 ç¼ºç‚¹ï¼šå®ç°è¾ƒå¤æ‚ï¼›ä¾èµ– MySQL 8+
============================================================ */
WITH cte AS (
  SELECT id, num,
         ROW_NUMBER() OVER(ORDER BY id) rn
  FROM Logs
)
SELECT MIN(id) start_id, MAX(id) end_id, num
FROM cte
GROUP BY num, id-rn;

-- é¢„æœŸè¾“å‡º (åŸºäºä¸Šé¢ Logs è¡¨)ï¼š
-- +----------+--------+-----+
-- | start_id | end_id | num |
-- +----------+--------+-----+
-- |    1     |   3    |  1  |
-- |    4     |   5    |  2  |
-- |    6     |   8    |  3  |
-- +----------+--------+-----+


/* ============================================================
 æ–¹æ³•äº”ï¼šå˜é‡æ³• (MySQL 5.x)
 ------------------------------------------------------------
 æ€è·¯ï¼šç”¨ @grp ç”¨æˆ·å˜é‡æ¨¡æ‹Ÿçª—å£å‡½æ•°åˆ†ç»„
 é€‚ç”¨åœºæ™¯ï¼šMySQL 5.x æ— çª—å£å‡½æ•°
 ä¼˜ç‚¹ï¼šå…¼å®¹è€ç‰ˆæœ¬
 ç¼ºç‚¹ï¼šå†™æ³•å¤æ‚ï¼Œå¯è¯»æ€§å·®
============================================================ */
SET @grp := 0;
SET @prev_date := NULL;

SELECT user_id,
       MIN(login_date) start_date,
       MAX(login_date) end_date
FROM (
  SELECT user_id, login_date,
         @grp := IF(@prev_date IS NULL 
                     OR DATEDIFF(login_date,@prev_date)>1, 
                    @grp+1, @grp) AS grp,
         @prev_date := login_date
  FROM Logins
  ORDER BY user_id, login_date
) t
GROUP BY user_id, grp;

-- é¢„æœŸè¾“å‡ºï¼ˆåŒæ–¹æ³•ä¸€ï¼‰ï¼š
-- +---------+------------+------------+
-- | user_id | start_date | end_date   |
-- +---------+------------+------------+
-- |   1     | 2023-01-01 | 2023-01-03 |
-- |   1     | 2023-01-05 | 2023-01-06 |
-- |   2     | 2023-01-01 | 2023-01-01 |
-- |   2     | 2023-01-04 | 2023-01-06 |
-- +---------+------------+------------+


/* ============================================================
 æ–¹æ³•å…­ï¼šé€’å½’ CTE æ³•
 ------------------------------------------------------------
 æ€è·¯ï¼šé€’å½’é€å¤©æ‰©å±•ï¼Œç›´åˆ°æ–­å¼€ä¸ºæ­¢
 é€‚ç”¨åœºæ™¯ï¼šéœ€è¦é“¾å¼é€’å½’åˆ¤æ–­çš„å¤æ‚æƒ…å†µ
 ä¼˜ç‚¹ï¼šçµæ´»ï¼Œå¯å¤„ç†ç‰¹æ®Šéœ€æ±‚
 ç¼ºç‚¹ï¼šæ€§èƒ½å·®ï¼Œé€’å½’å±‚æ•°æ·±å¼€é”€å¤§ï¼›MySQL 8+ æ”¯æŒ
============================================================ */
WITH RECURSIVE seq AS (
  SELECT user_id, login_date, login_date AS start_date
  FROM Logins
  UNION ALL
  SELECT l.user_id, l.login_date, s.start_date
  FROM Logins l
  JOIN seq s
    ON l.user_id=s.user_id
   AND l.login_date = DATE_ADD(s.login_date, INTERVAL 1 DAY)
)
SELECT user_id, start_date, MAX(login_date) AS end_date
FROM seq
GROUP BY user_id, start_date;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+------------+------------+
-- | user_id | start_date | end_date   |
-- +---------+------------+------------+
-- |   1     | 2023-01-01 | 2023-01-03 |
-- |   1     | 2023-01-05 | 2023-01-06 |
-- |   2     | 2023-01-01 | 2023-01-01 |
-- |   2     | 2023-01-04 | 2023-01-06 |
-- +---------+------------+------------+


/* ============================================================
 æ–¹æ³•ä¸ƒï¼šè‡ªè¿æ¥æ³•
 ------------------------------------------------------------
 æ€è·¯ï¼šJOIN å‰ä¸€å¤©/å‰ä¸¤å¤©ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¿ç»­ N å¤©
 é€‚ç”¨åœºæ™¯ï¼šæ£€æµ‹æ˜¯å¦å­˜åœ¨è¿ç»­ N å¤©ï¼ˆå›ºå®š Nï¼‰
 ä¼˜ç‚¹ï¼šç®€å•ç›´è§‚ï¼Œä¸ä¾èµ–çª—å£å‡½æ•°
 ç¼ºç‚¹ï¼šN è¶Šå¤§ JOIN è¶Šå¤šï¼Œå¯æ‰©å±•æ€§å·®
============================================================ */
SELECT DISTINCT l1.user_id
FROM Logins l1
JOIN Logins l2 ON l2.user_id=l1.user_id 
              AND l2.login_date=DATE_ADD(l1.login_date,INTERVAL 1 DAY)
JOIN Logins l3 ON l3.user_id=l1.user_id 
              AND l3.login_date=DATE_ADD(l1.login_date,INTERVAL 2 DAY);

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+
-- | user_id |
-- +---------+
-- |    1    |
-- |    2    |
-- +---------+

```

| æ–¹æ³•               | ä¾èµ–ç‰ˆæœ¬  | ä¼˜ç‚¹             | ç¼ºç‚¹                   | é€‚ç”¨åœºæ™¯     |
| ------------------ | --------- | ---------------- | ---------------------- | ------------ |
| **Anchor Key**     | MySQL 8+  | ç®€æ´é«˜æ•ˆï¼Œå¯æ‰©å±• | éœ€çª—å£å‡½æ•°             | è¿ç»­åŒºé—´åˆ’åˆ† |
| **LAG/LEAD**       | MySQL 8+  | åˆ¤æ–­æ–­ç‚¹ç›´è§‚     | åªèƒ½æ‰¾æ–­ç‚¹ï¼Œéœ€äºŒæ¬¡èšåˆ | æ‰¾åºåˆ—æ–­ç‚¹   |
| **è¿ç»­ N æ¬¡ç›¸åŒ**  | MySQL 8+  | æ¨¡æ¿åŒ–ï¼Œæ˜“å†™     | ä»…é€‚ç”¨å›ºå®š N           | è¿ç»­ N å€¼    |
| **Gaps & Islands** | MySQL 8+  | ç†è®ºç»å…¸ï¼Œé€šç”¨   | å†™æ³•ç¨å¤æ‚             | è¿ç»­æ•°åˆ—åˆ†æ®µ |
| **å˜é‡æ³•**         | MySQL 5.x | æ— çª—å£æ—¶å”¯ä¸€é€‰æ‹© | å†™æ³•å¤æ‚ï¼Œå¯è¯»æ€§å·®     | è€ç‰ˆæœ¬       |
| **é€’å½’ CTE**       | MySQL 8+  | çµæ´»ï¼Œå¯é€è¡Œé€’å½’ | æ€§èƒ½ä¸€èˆ¬               | å¤æ‚è¿ç»­é—®é¢˜ |
| **è‡ªè¿æ¥**         | MySQL 5+  | ç›´è§‚ï¼Œä¸éœ€çª—å£   | N è¶Šå¤§ JOIN è¶Šå¤š       | è¿ç»­ N å¤©    |

------

## 9ï¸âƒ£ æ¡ä»¶èšåˆï¼ˆCASE WHENï¼‰

```sql
/* ============================================================
   æ¡ä»¶èšåˆï¼ˆCASE WHENï¼‰å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   ç¤ºä¾‹è¡¨ï¼šOrders
   +----+---------+----------+------------+
   | id | user_id | status   | amount     |
   +----+---------+----------+------------+
   |  1 |    1    | completed|   100      |
   |  2 |    1    | canceled |   200      |
   |  3 |    1    | completed|   150      |
   |  4 |    2    | completed|   300      |
   |  5 |    2    | completed|   250      |
   |  6 |    3    | canceled |   400      |
   +----+---------+----------+------------+
============================================================ */


/* ============================================================
 1. æŒ‰æ¡ä»¶è®¡æ•°
   åº”ç”¨ï¼šæ¯ä¸ªç”¨æˆ·å®Œæˆ/å–æ¶ˆè®¢å•æ•°
============================================================ */
SELECT user_id,
       SUM(CASE WHEN status='completed' THEN 1 ELSE 0 END) AS completed_orders,
       SUM(CASE WHEN status='canceled' THEN 1 ELSE 0 END) AS canceled_orders
FROM Orders
GROUP BY user_id;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+----------------+----------------+
-- | user_id | completed_orders | canceled_orders |
-- +---------+----------------+----------------+
-- |    1    |        2       |        1       |
-- |    2    |        2       |        0       |
-- |    3    |        0       |        1       |
-- +---------+----------------+----------------+


/* ============================================================
 2. æŒ‰æ¡ä»¶æ±‚å’Œ
   åº”ç”¨ï¼šæ¯ä¸ªç”¨æˆ·å®Œæˆ/å–æ¶ˆè®¢å•é‡‘é¢
============================================================ */
SELECT user_id,
       SUM(CASE WHEN status='completed' THEN amount ELSE 0 END) AS completed_amount,
       SUM(CASE WHEN status='canceled' THEN amount ELSE 0 END) AS canceled_amount
FROM Orders
GROUP BY user_id;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+----------------+----------------+
-- | user_id | completed_amount | canceled_amount |
-- +---------+----------------+----------------+
-- |    1    |      250        |      200       |
-- |    2    |      550        |        0       |
-- |    3    |        0        |      400       |
-- +---------+----------------+----------------+


/* ============================================================
 3. æŒ‰æ¡ä»¶æ±‚å¹³å‡
   åº”ç”¨ï¼šæ¯ä¸ªç”¨æˆ·å®Œæˆè®¢å•çš„å¹³å‡é‡‘é¢
============================================================ */
SELECT user_id,
       AVG(CASE WHEN status='completed' THEN amount END) AS avg_completed_amount
FROM Orders
GROUP BY user_id;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+----------------------+
-- | user_id | avg_completed_amount |
-- +---------+----------------------+
-- |    1    |        125.0         |
-- |    2    |        275.0         |
-- |    3    |        NULL          |
-- +---------+----------------------+


/* ============================================================
 4. å¤šæ¡ä»¶åˆ†ç±»ç»Ÿè®¡
   åº”ç”¨ï¼šæ¯ä¸ªç”¨æˆ·è®¢å•é‡‘é¢ï¼ŒæŒ‰åŒºé—´åˆ†ç±»
============================================================ */
SELECT user_id,
       SUM(CASE WHEN amount < 200 THEN 1 ELSE 0 END) AS small_orders,
       SUM(CASE WHEN amount BETWEEN 200 AND 300 THEN 1 ELSE 0 END) AS medium_orders,
       SUM(CASE WHEN amount > 300 THEN 1 ELSE 0 END) AS large_orders
FROM Orders
GROUP BY user_id;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+--------------+---------------+--------------+
-- | user_id | small_orders | medium_orders | large_orders |
-- +---------+--------------+---------------+--------------+
-- |    1    |      2       |       1       |      0       |
-- |    2    |      0       |       2       |      0       |
-- |    3    |      0       |       0       |      1       |
-- +---------+--------------+---------------+--------------+


/* ============================================================
 5. ä¸ HAVING æ­é…
   åº”ç”¨ï¼šç­›é€‰å‡ºå–æ¶ˆè®¢å•æ•° > 0 çš„ç”¨æˆ·
============================================================ */
SELECT user_id,
       SUM(CASE WHEN status='canceled' THEN 1 ELSE 0 END) AS canceled_orders
FROM Orders
GROUP BY user_id
HAVING canceled_orders > 0;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+----------------+
-- | user_id | canceled_orders|
-- +---------+----------------+
-- |    1    |       1        |
-- |    3    |       1        |
-- +---------+----------------+


/* ============================================================
 6. ä¸ DISTINCT æ­é…
   åº”ç”¨ï¼šæ¯ä¸ªç”¨æˆ·å®Œæˆè®¢å•æ¶‰åŠçš„ä¸åŒé‡‘é¢ç§ç±»æ•°
============================================================ */
SELECT user_id,
       COUNT(DISTINCT CASE WHEN status='completed' THEN amount END) AS diff_completed_amounts
FROM Orders
GROUP BY user_id;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+----------------------+
-- | user_id | diff_completed_amounts |
-- +---------+----------------------+
-- |    1    |          2           |
-- |    2    |          2           |
-- |    3    |          0           |
-- +---------+----------------------+

```

------

## ğŸ”Ÿ æ›´æ–° / æ›¿æ¢ï¼ˆUPDATE + CASEï¼‰

```sql
-- æ¡ä»¶æ›´æ–°
UPDATE table
SET col = CASE
            WHEN col='A' THEN 'B'
            ELSE 'A'
          END;

-- Swap å€¼
UPDATE Salary
SET sex=CASE WHEN sex='m' THEN 'f' ELSE 'm' END;
```

------

## 1ï¸âƒ£1ï¸âƒ£ åˆ é™¤ï¼ˆDELETEï¼‰

```sql
-- åˆ é™¤ä¸éœ€è¦çš„æ•°æ®
DELETE FROM table
WHERE condition;

-- åˆ é™¤é‡å¤
DELETE t1
FROM table t1
JOIN table t2
ON t1.col=t2.col
WHERE t1.id>t2.id;
```

------

## 1ï¸âƒ£2ï¸âƒ£ æ—¥æœŸå‡½æ•°ï¼ˆDATEDIFF, YEAR, MONTHï¼‰

```sql
/* ============================================================
   æ—¥æœŸå‡½æ•°ï¼ˆMySQLï¼‰å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   ç¤ºä¾‹è¡¨ï¼šOrders
   +----+---------+------------+
   | id | user_id | order_date |
   +----+---------+------------+
   |  1 |    1    | 2023-01-01 |
   |  2 |    1    | 2023-01-05 |
   |  3 |    2    | 2023-01-07 |
   |  4 |    2    | 2023-02-01 |
   |  5 |    3    | 2023-02-15 |
   |  6 |    3    | 2023-03-10 |
   +----+---------+------------+
============================================================ */


/* ============================================================
 1. å½“å‰æ—¥æœŸå’Œæ—¶é—´
============================================================ */
SELECT CURDATE() AS today, NOW() AS current_time;

-- é¢„æœŸè¾“å‡ºï¼š
-- +------------+---------------------+
-- | today      | current_time        |
-- +------------+---------------------+
-- | 2025-08-27 | 2025-08-27 22:00:00 |
-- +------------+---------------------+


/* ============================================================
 2. æå–å¹´ä»½ã€æœˆä»½ã€æ—¥
============================================================ */
SELECT id, user_id, order_date,
       YEAR(order_date) AS year_val,
       MONTH(order_date) AS month_val,
       DAY(order_date) AS day_val
FROM Orders;

-- é¢„æœŸè¾“å‡ºï¼š
-- +----+---------+------------+----------+-----------+--------+
-- | id | user_id | order_date | year_val | month_val | day_val|
-- +----+---------+------------+----------+-----------+--------+
-- |  1 |    1    | 2023-01-01 | 2023     |    1      |   1    |
-- |  2 |    1    | 2023-01-05 | 2023     |    1      |   5    |
-- |  3 |    2    | 2023-01-07 | 2023     |    1      |   7    |
-- |  4 |    2    | 2023-02-01 | 2023     |    2      |   1    |
-- |  5 |    3    | 2023-02-15 | 2023     |    2      |   15   |
-- |  6 |    3    | 2023-03-10 | 2023     |    3      |   10   |
-- +----+---------+------------+----------+-----------+--------+


/* ============================================================
 3. æå–æ˜ŸæœŸå‡ 
============================================================ */
SELECT id, order_date,
       DAYNAME(order_date) AS day_name,
       WEEKDAY(order_date) AS weekday_index  -- å‘¨ä¸€=0
FROM Orders;

-- é¢„æœŸè¾“å‡º (å¯èƒ½å› ç³»ç»Ÿä¸åŒç•¥æœ‰å·®å¼‚)ï¼š
-- +----+------------+-----------+---------------+
-- | id | order_date | day_name  | weekday_index |
-- +----+------------+-----------+---------------+
-- |  1 | 2023-01-01 | Sunday    | 6             |
-- |  2 | 2023-01-05 | Thursday  | 3             |
-- |  3 | 2023-01-07 | Saturday  | 5             |
-- |  4 | 2023-02-01 | Wednesday | 2             |
-- |  5 | 2023-02-15 | Wednesday | 2             |
-- |  6 | 2023-03-10 | Friday    | 4             |
-- +----+------------+-----------+---------------+


/* ============================================================
 4. DATEDIFFï¼ˆæ—¥æœŸå·®ï¼‰
============================================================ */
SELECT o1.id AS order1, o2.id AS order2,
       DATEDIFF(o2.order_date, o1.order_date) AS days_diff
FROM Orders o1
JOIN Orders o2 ON o1.user_id=o2.user_id AND o2.id>o1.id;

-- é¢„æœŸè¾“å‡ºï¼š
-- +--------+--------+-----------+
-- | order1 | order2 | days_diff |
-- +--------+--------+-----------+
-- |   1    |   2    |     4     |
-- |   2    |   4    |    27     |
-- |   4    |   5    |    14     |
-- |   5    |   6    |    23     |
-- +--------+--------+-----------+


/* ============================================================
 5. DATE_ADD / DATE_SUBï¼ˆåŠ å‡æ—¥æœŸï¼‰
============================================================ */
SELECT id, order_date,
       DATE_ADD(order_date, INTERVAL 7 DAY) AS plus_7days,
       DATE_SUB(order_date, INTERVAL 7 DAY) AS minus_7days
FROM Orders;

-- é¢„æœŸè¾“å‡ºï¼š
-- +----+------------+------------+------------+
-- | id | order_date | plus_7days | minus_7days|
-- +----+------------+------------+------------+
-- |  1 | 2023-01-01 | 2023-01-08 | 2022-12-25 |
-- |  2 | 2023-01-05 | 2023-01-12 | 2022-12-29 |
-- |  3 | 2023-01-07 | 2023-01-14 | 2022-12-31 |
-- |  4 | 2023-02-01 | 2023-02-08 | 2023-01-25 |
-- |  5 | 2023-02-15 | 2023-02-22 | 2023-02-08 |
-- |  6 | 2023-03-10 | 2023-03-17 | 2023-03-03 |
-- +----+------------+------------+------------+


/* ============================================================
 6. DATE_FORMATï¼ˆæ—¥æœŸæ ¼å¼åŒ–ï¼‰
============================================================ */
SELECT id, order_date,
       DATE_FORMAT(order_date, '%Y-%m') AS year_month,
       DATE_FORMAT(order_date, '%b %d, %Y') AS pretty_format
FROM Orders;

-- é¢„æœŸè¾“å‡ºï¼š
-- +----+------------+-----------+----------------+
-- | id | order_date | year_month| pretty_format  |
-- +----+------------+-----------+----------------+
-- |  1 | 2023-01-01 | 2023-01   | Jan 01, 2023   |
-- |  2 | 2023-01-05 | 2023-01   | Jan 05, 2023   |
-- |  3 | 2023-01-07 | 2023-01   | Jan 07, 2023   |
-- |  4 | 2023-02-01 | 2023-02   | Feb 01, 2023   |
-- |  5 | 2023-02-15 | 2023-02   | Feb 15, 2023   |
-- |  6 | 2023-03-10 | 2023-03   | Mar 10, 2023   |
-- +----+------------+-----------+----------------+


/* ============================================================
 7. TIMESTAMPDIFFï¼ˆä¸¤ä¸ªæ—¥æœŸçš„å·®ï¼Œå•ä½å¯é€‰ï¼‰
============================================================ */
SELECT o1.id AS order1, o2.id AS order2,
       TIMESTAMPDIFF(DAY, o1.order_date, o2.order_date) AS diff_days,
       TIMESTAMPDIFF(MONTH, o1.order_date, o2.order_date) AS diff_months
FROM Orders o1
JOIN Orders o2 ON o1.user_id=o2.user_id AND o2.id>o1.id;

-- é¢„æœŸè¾“å‡ºï¼š
-- +--------+--------+-----------+-------------+
-- | order1 | order2 | diff_days | diff_months |
-- +--------+--------+-----------+-------------+
-- |   1    |   2    |     4     |     0       |
-- |   2    |   4    |    27     |     0       |
-- |   4    |   5    |    14     |     0       |
-- |   5    |   6    |    23     |     0       |
-- +--------+--------+-----------+-------------+

```

------

## 1ï¸âƒ£3ï¸âƒ£ å­—ç¬¦ä¸²å‡½æ•°ï¼ˆLIKE, SUBSTRING, CONCATï¼‰

```sql
/* ============================================================
   å­—ç¬¦ä¸²å‡½æ•°ï¼ˆMySQLï¼‰å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   ç¤ºä¾‹è¡¨ï¼šUsers
   +----+----------+----------------------+
   | id | name     | email                |
   +----+----------+----------------------+
   |  1 | Alice    | alice@leetcode.com   |
   |  2 | Bob      | bob_smith@company.com|
   |  3 | Carol    | carol@leetcode.com   |
   |  4 | David    | david@test.org       |
   |  5 | Eva      | eva@company.com      |
   +----+----------+----------------------+
============================================================ */


/* ============================================================
 1. LENGTH / CHAR_LENGTH (å­—ç¬¦ä¸²é•¿åº¦)
============================================================ */
SELECT name, email,
       LENGTH(email) AS byte_len,
       CHAR_LENGTH(email) AS char_len
FROM Users;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+----------------------+----------+----------+
-- | name  | email                | byte_len | char_len |
-- +-------+----------------------+----------+----------+
-- | Alice | alice@leetcode.com   |   18     |   18     |
-- | Bob   | bob_smith@company.com|   22     |   22     |
-- | Carol | carol@leetcode.com   |   18     |   18     |
-- | David | david@test.org       |   15     |   15     |
-- | Eva   | eva@company.com      |   17     |   17     |
-- +-------+----------------------+----------+----------+


/* ============================================================
 2. UPPER / LOWER (å¤§å°å†™è½¬æ¢)
============================================================ */
SELECT name,
       UPPER(name) AS upper_name,
       LOWER(name) AS lower_name
FROM Users;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+------------+------------+
-- | name  | upper_name | lower_name |
-- +-------+------------+------------+
-- | Alice | ALICE      | alice      |
-- | Bob   | BOB        | bob        |
-- | Carol | CAROL      | carol      |
-- | David | DAVID      | david      |
-- | Eva   | EVA        | eva        |
-- +-------+------------+------------+


/* ============================================================
 3. SUBSTRING (æˆªå–å­ä¸²)
============================================================ */
SELECT email,
       SUBSTRING(email, 1, 5) AS first5,
       SUBSTRING(email, -3) AS last3
FROM Users;

-- é¢„æœŸè¾“å‡ºï¼š
-- +----------------------+---------+-------+
-- | email                | first5  | last3 |
-- +----------------------+---------+-------+
-- | alice@leetcode.com   | alice   | com   |
-- | bob_smith@company.com| bob_s   | com   |
-- | carol@leetcode.com   | carol   | com   |
-- | david@test.org       | david   | org   |
-- | eva@company.com      | eva@c   | com   |
-- +----------------------+---------+-------+


/* ============================================================
 4. LEFT / RIGHT (æˆªå–å·¦è¾¹/å³è¾¹)
============================================================ */
SELECT email,
       LEFT(email, 5) AS left5,
       RIGHT(email, 3) AS right3
FROM Users;

-- é¢„æœŸè¾“å‡ºï¼š
-- +----------------------+-------+--------+
-- | email                | left5 | right3 |
-- +----------------------+-------+--------+
-- | alice@leetcode.com   | alice | com    |
-- | bob_smith@company.com| bob_s | com    |
-- | carol@leetcode.com   | carol | com    |
-- | david@test.org       | david | org    |
-- | eva@company.com      | eva@c | com    |
-- +----------------------+-------+--------+


/* ============================================================
 5. CONCAT / CONCAT_WS (æ‹¼æ¥å­—ç¬¦ä¸²)
============================================================ */
SELECT name, email,
       CONCAT(name, '-', email) AS combined,
       CONCAT_WS(' | ', name, email) AS combined_ws
FROM Users;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+----------------------+----------------------------+----------------------------+
-- | name  | email                | combined                   | combined_ws                |
-- +-------+----------------------+----------------------------+----------------------------+
-- | Alice | alice@leetcode.com   | Alice-alice@leetcode.com   | Alice | alice@leetcode.com |
-- | Bob   | bob_smith@company.com| Bob-bob_smith@company.com  | Bob | bob_smith@company.com|
-- | Carol | carol@leetcode.com   | Carol-carol@leetcode.com   | Carol | carol@leetcode.com |
-- | David | david@test.org       | David-david@test.org       | David | david@test.org     |
-- | Eva   | eva@company.com      | Eva-eva@company.com        | Eva | eva@company.com      |
-- +-------+----------------------+----------------------------+----------------------------+


/* ============================================================
 6. REPLACE (æ›¿æ¢å­—ç¬¦ä¸²)
============================================================ */
SELECT email,
       REPLACE(email, 'leetcode', 'gmail') AS replaced
FROM Users;

-- é¢„æœŸè¾“å‡ºï¼š
-- +----------------------+--------------------+
-- | email                | replaced           |
-- +----------------------+--------------------+
-- | alice@leetcode.com   | alice@gmail.com    |
-- | bob_smith@company.com| bob_smith@company.com |
-- | carol@leetcode.com   | carol@gmail.com    |
-- | david@test.org       | david@test.org     |
-- | eva@company.com      | eva@company.com    |
-- +----------------------+--------------------+


/* ============================================================
 7. INSTR / LOCATE (æŸ¥æ‰¾å­ä¸²ä½ç½®)
============================================================ */
SELECT email,
       INSTR(email, '@') AS at_pos,
       LOCATE('com', email) AS com_pos
FROM Users;

-- é¢„æœŸè¾“å‡ºï¼š
-- +----------------------+--------+---------+
-- | email                | at_pos | com_pos |
-- +----------------------+--------+---------+
-- | alice@leetcode.com   |   6    |   15    |
-- | bob_smith@company.com|   9    |   20    |
-- | carol@leetcode.com   |   6    |   15    |
-- | david@test.org       |   6    |   11    |
-- | eva@company.com      |   4    |   13    |
-- +----------------------+--------+---------+


/* ============================================================
 8. TRIM / LTRIM / RTRIM (å»é™¤ç©ºæ ¼)
============================================================ */
SELECT '   hello   ' AS raw_str,
       TRIM('   hello   ') AS trimmed,
       LTRIM('   hello   ') AS left_trimmed,
       RTRIM('   hello   ') AS right_trimmed;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------------+---------+--------------+---------------+
-- | raw_str     | trimmed | left_trimmed | right_trimmed |
-- +-------------+---------+--------------+---------------+
-- |    hello    | hello   | hello        |    hello      |
-- +-------------+---------+--------------+---------------+


/* ============================================================
 9. REVERSE (å­—ç¬¦ä¸²åè½¬)
============================================================ */
SELECT name, REVERSE(name) AS reversed
FROM Users;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+----------+
-- | name  | reversed |
-- +-------+----------+
-- | Alice | ecilA    |
-- | Bob   | boB      |
-- | Carol | loraC    |
-- | David | divaD    |
-- | Eva   | avE      |
-- +-------+----------+


/* ============================================================
 10. LPAD / RPAD (å­—ç¬¦ä¸²å¡«å……)
============================================================ */
SELECT name,
       LPAD(name, 10, '*') AS left_padded,
       RPAD(name, 10, '_') AS right_padded
FROM Users;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+------------+-------------+
-- | name  | left_padded| right_padded|
-- +-------+------------+-------------+
-- | Alice | *****Alice | Alice_____  |
-- | Bob   | *******Bob | Bob_______  |
-- | Carol | *****Carol | Carol_____  |
-- | David | *****David | David_____  |
-- | Eva   | *******Eva | Eva_______  |
-- +-------+------------+-------------+

```

------

## 1ï¸âƒ£4ï¸âƒ£ ç»¼åˆç»Ÿè®¡ï¼ˆç™¾åˆ†æ¯”ã€å æ¯”ï¼‰

```sql
/* ============================================================
   ç»¼åˆç»Ÿè®¡ï¼ˆç™¾åˆ†æ¯”ã€å æ¯”ï¼‰å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   ç¤ºä¾‹è¡¨ï¼šOrders
   +----+---------+---------+--------+
   | id | user_id | product | amount |
   +----+---------+---------+--------+
   |  1 |    1    |   A     |  100   |
   |  2 |    1    |   B     |  200   |
   |  3 |    2    |   A     |  150   |
   |  4 |    2    |   C     |  300   |
   |  5 |    3    |   A     |  100   |
   |  6 |    3    |   B     |  100   |
   |  7 |    3    |   C     |  200   |
   +----+---------+---------+--------+
============================================================ */


/* ============================================================
 1. å„åˆ†ç»„å æ¯”ï¼ˆç›¸å¯¹æ€»æ•°ç™¾åˆ†æ¯”ï¼‰
   åº”ç”¨ï¼šæ¯ä¸ªäº§å“è®¢å•æ•°å æ¯”
============================================================ */
SELECT product,
       COUNT(*) AS order_count,
       ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM Orders), 2) AS pct
FROM Orders
GROUP BY product;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+-------------+-------+
-- | product | order_count | pct   |
-- +---------+-------------+-------+
-- | A       |     3       | 42.86 |
-- | B       |     2       | 28.57 |
-- | C       |     2       | 28.57 |
-- +---------+-------------+-------+


/* ============================================================
 2. å„åˆ†ç»„é‡‘é¢å æ¯”
   åº”ç”¨ï¼šæ¯ä¸ªç”¨æˆ·æ¶ˆè´¹é‡‘é¢å æ¯”
============================================================ */
SELECT user_id,
       SUM(amount) AS total_amount,
       ROUND(SUM(amount) * 100.0 / (SELECT SUM(amount) FROM Orders), 2) AS pct
FROM Orders
GROUP BY user_id;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+--------------+-------+
-- | user_id | total_amount | pct   |
-- +---------+--------------+-------+
-- |    1    |    300       | 25.00 |
-- |    2    |    450       | 37.50 |
-- |    3    |    400       | 37.50 |
-- +---------+--------------+-------+


/* ============================================================
 3. å„åˆ†ç»„å æ¯”ï¼ˆçª—å£å‡½æ•°ç‰ˆï¼ŒMySQL 8+ï¼‰
   åº”ç”¨ï¼šæ¯ä¸ªäº§å“è®¢å•æ•°å æ¯”
============================================================ */
SELECT product,
       COUNT(*) AS order_count,
       ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) AS pct
FROM Orders
GROUP BY product;

-- é¢„æœŸè¾“å‡ºï¼ˆåŒæ–¹æ³•1ï¼‰ï¼š
-- +---------+-------------+-------+
-- | product | order_count | pct   |
-- +---------+-------------+-------+
-- | A       |     3       | 42.86 |
-- | B       |     2       | 28.57 |
-- | C       |     2       | 28.57 |
-- +---------+-------------+-------+


/* ============================================================
 4. åˆ†ç»„å†…å æ¯”
   åº”ç”¨ï¼šæ¯ä¸ªç”¨æˆ·åœ¨å„äº§å“çš„æ¶ˆè´¹å æ¯”
============================================================ */
SELECT user_id, product,
       SUM(amount) AS total_amount,
       ROUND(SUM(amount) * 100.0 / SUM(SUM(amount)) OVER(PARTITION BY user_id), 2) AS pct_in_user
FROM Orders
GROUP BY user_id, product;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+---------+--------------+-------------+
-- | user_id | product | total_amount | pct_in_user |
-- +---------+---------+--------------+-------------+
-- |    1    |   A     |    100       |   33.33     |
-- |    1    |   B     |    200       |   66.67     |
-- |    2    |   A     |    150       |   33.33     |
-- |    2    |   C     |    300       |   66.67     |
-- |    3    |   A     |    100       |   25.00     |
-- |    3    |   B     |    100       |   25.00     |
-- |    3    |   C     |    200       |   50.00     |
-- +---------+---------+--------------+-------------+


/* ============================================================
 5. ç´¯è®¡å æ¯” (Running Percentage)
   åº”ç”¨ï¼šæŒ‰æ¶ˆè´¹é‡‘é¢æ’åºï¼Œç´¯è®¡ç™¾åˆ†æ¯”
============================================================ */
SELECT user_id, SUM(amount) AS total_amount,
       ROUND(SUM(amount) * 100.0 / SUM(SUM(amount)) OVER(), 2) AS pct,
       ROUND(SUM(SUM(amount)) OVER(ORDER BY SUM(amount) DESC) * 100.0 / SUM(SUM(amount)) OVER(), 2) AS cum_pct
FROM Orders
GROUP BY user_id
ORDER BY total_amount DESC;

-- é¢„æœŸè¾“å‡ºï¼š
-- +---------+--------------+-------+---------+
-- | user_id | total_amount | pct   | cum_pct |
-- +---------+--------------+-------+---------+
-- |    2    |    450       | 37.50 | 37.50   |
-- |    3    |    400       | 33.33 | 70.83   |
-- |    1    |    300       | 25.00 | 95.83   |
-- +---------+--------------+-------+---------+

```

------

## 1ï¸âƒ£5ï¸âƒ£ å¤æ‚åœºæ™¯ï¼ˆå¤šè¡¨ + èšåˆ + çª—å£ï¼‰

```sql
/* ============================================================
   å¤æ‚åœºæ™¯ï¼ˆå¤šè¡¨ + èšåˆ + çª—å£å‡½æ•°ï¼‰å¸¸ç”¨æ¨¡ç‰ˆå…¨é›†
   ============================================================
   ç¤ºä¾‹è¡¨ï¼š
   Employee
   +----+---------+-------------+--------+
   | id | name    | department  | salary |
   +----+---------+-------------+--------+
   |  1 | Alice   | HR          | 6000   |
   |  2 | Bob     | HR          | 7000   |
   |  3 | Carol   | HR          | 7000   |
   |  4 | David   | IT          | 8000   |
   |  5 | Eva     | IT          | 9000   |
   |  6 | Frank   | IT          | 7500   |
   +----+---------+-------------+--------+

   Department
   +-------------+--------------+
   | dept_id     | dept_name    |
   +-------------+--------------+
   | HR          | HumanRes     |
   | IT          | Tech         |
   +-------------+--------------+
============================================================ */


/* ============================================================
 1. å¤šè¡¨ JOIN + èšåˆ
   åº”ç”¨ï¼šæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„
============================================================ */
SELECT d.dept_name,
       AVG(e.salary) AS avg_salary
FROM Employee e
JOIN Department d ON e.department = d.dept_id
GROUP BY d.dept_name;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-----------+------------+
-- | dept_name | avg_salary |
-- +-----------+------------+
-- | HumanRes  |   6666.7   |
-- | Tech      |   8166.7   |
-- +-----------+------------+


/* ============================================================
 2. å¤šè¡¨ JOIN + èšåˆ + HAVING
   åº”ç”¨ï¼šæ‰¾å¹³å‡å·¥èµ„ > 7000 çš„éƒ¨é—¨
============================================================ */
SELECT d.dept_name,
       AVG(e.salary) AS avg_salary
FROM Employee e
JOIN Department d ON e.department = d.dept_id
GROUP BY d.dept_name
HAVING AVG(e.salary) > 7000;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-----------+------------+
-- | dept_name | avg_salary |
-- +-----------+------------+
-- | Tech      |   8166.7   |
-- +-----------+------------+


/* ============================================================
 3. å¤šè¡¨ JOIN + çª—å£å‡½æ•°
   åº”ç”¨ï¼šæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥ (RANK)
============================================================ */
SELECT name, department, salary
FROM (
  SELECT e.name, e.department, e.salary,
         RANK() OVER(PARTITION BY e.department ORDER BY e.salary DESC) rk
  FROM Employee e
) t
WHERE rk = 1;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-------+------------+--------+
-- | name  | department | salary |
-- +-------+------------+--------+
-- | Bob   | HR         | 7000   |
-- | Carol | HR         | 7000   |
-- | Eva   | IT         | 9000   |
-- +-------+------------+--------+


/* ============================================================
 4. å¤šè¡¨ JOIN + æ¡ä»¶èšåˆ (CASE WHEN)
   åº”ç”¨ï¼šæ¯ä¸ªéƒ¨é—¨å®Œæˆæ¡ä»¶çš„ç»Ÿè®¡
============================================================ */
SELECT d.dept_name,
       SUM(CASE WHEN e.salary >= 8000 THEN 1 ELSE 0 END) AS high_salary_count,
       SUM(CASE WHEN e.salary < 8000 THEN 1 ELSE 0 END) AS low_salary_count
FROM Employee e
JOIN Department d ON e.department = d.dept_id
GROUP BY d.dept_name;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-----------+-------------------+------------------+
-- | dept_name | high_salary_count | low_salary_count |
-- +-----------+-------------------+------------------+
-- | HumanRes  |        0          |        3         |
-- | Tech      |        2          |        1         |
-- +-----------+-------------------+------------------+


/* ============================================================
 5. å¤šè¡¨ JOIN + çª—å£å‡½æ•° + èšåˆ
   åº”ç”¨ï¼šæŒ‰éƒ¨é—¨å·¥èµ„é™åºï¼Œç»Ÿè®¡ç´¯è®¡å·¥èµ„
============================================================ */
SELECT d.dept_name, e.name, e.salary,
       SUM(e.salary) OVER(PARTITION BY d.dept_id ORDER BY e.salary DESC) AS running_total
FROM Employee e
JOIN Department d ON e.department = d.dept_id;

-- é¢„æœŸè¾“å‡ºï¼š
-- +-----------+-------+--------+---------------+
-- | dept_name | name  | salary | running_total |
-- +-----------+-------+--------+---------------+
-- | HumanRes  | Bob   | 7000   | 7000          |
-- | HumanRes  | Carol | 7000   | 14000         |
-- | HumanRes  | Alice | 6000   | 20000         |
-- | Tech      | Eva   |

```

------

# ğŸ“‘ é«˜é¢‘å£è¯€ï¼ˆç»ˆææ€»ç»“ï¼‰

- **Top-N / Nth é«˜**ï¼š`LIMIT OFFSET` / `DENSE_RANK()`
- **åˆ†ç»„èšåˆç­›é€‰**ï¼š`GROUP BY + HAVING`
- **çª—å£å‡½æ•°**ï¼š`RANK / ROW_NUMBER / LAG / LEAD`
- **è¿ç»­åŒºé—´**ï¼š`ROW_NUMBER + anchor key`
- **å»é‡åˆ é™¤**ï¼š`GROUP BY HAVING COUNT>1` æˆ– `DELETE self-join`
- **æ¡ä»¶èšåˆ**ï¼š`SUM(CASE WHEN â€¦ END)`
- **å­˜åœ¨æ€§**ï¼š`EXISTS / NOT EXISTS`
- **å­—ç¬¦ä¸²**ï¼š`LIKE / SUBSTRING / CONCAT / REPLACE`
- **æ—¥æœŸ**ï¼š`DATEDIFF / DATE_ADD / YEAR / MONTH`
- **ç™¾åˆ†æ¯”**ï¼š`COUNT(*) / SUM(COUNT(*)) OVER()`

